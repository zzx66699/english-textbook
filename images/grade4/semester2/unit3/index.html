<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unit 3 ç”µè„‘ä¸“ç”¨ç‰ˆ</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        :root { --pink: #ffdae0; --blue: #c0e8ff; --green: #d1f4e0; --yellow: #fff2cc; --text: #5d4037; --soft-white: #f5f5f5; --nav-bg: #ffffff; }
        body { font-family: "Comic Sans MS", "å¹¼åœ†", sans-serif; background: var(--soft-white); margin: 0; display: flex; flex-direction: column; align-items: center; color: var(--text); padding-bottom: 60px; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        .top-bar { width: 96vw; max-width: 800px; background: var(--nav-bg); padding: 15px 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; align-items: center; border: 4px solid var(--green); border-top: none; border-radius: 0 0 20px 20px; position: sticky; top: 0; z-index: 200; box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .nav-btn { background: var(--pink); border: 3px solid #fff; color: #d84315; padding: 8px 24px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 900; box-shadow: 0 4px 0 #ffab91; transition: all 0.1s; }
        .nav-btn:active { transform: translateY(4px); box-shadow: none; }
        .nav-btn:disabled { background: #eeeeee; box-shadow: none; color: #ccc; cursor: not-allowed; border-color:#eee;}
        .config-item { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: bold; }
        .icon-emoji { font-size: 28px; line-height: 1; }
        select { border: 3px solid var(--blue); border-radius: 12px; padding: 8px 5px; font-size: 16px; font-weight: bold; color: #555; max-width: 140px; outline: none; background: #fff; }
        .page-badge { background: var(--yellow); padding: 8px 20px; border-radius: 20px; color: #f9a825; font-weight: 900; font-size: 18px; border: 3px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input[type=range] { transform: scale(1.2); margin: 0 5px; accent-color: var(--pink); cursor: pointer; }
        .book-container { position: relative; width: 96vw; max-width: 800px; aspect-ratio: 780 / 1100; margin: 20px 0; background: #ffffff; border: 8px solid var(--green); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .page-img { width: 100%; height: 100%; position: absolute; top: 0; left: 0; object-fit: fill; }
        .hotspot { position: absolute; cursor: pointer; z-index: 10; border-radius: 8px; }
        .hotspot:active { background: rgba(255, 255, 0, 0.3); } 
        
        /* ç¿»è¯‘æ°”æ³¡ */
        .trans-popup { 
            position: absolute; 
            background: rgba(255, 255, 255, 0.95); 
            border: 3px solid var(--pink); 
            border-radius: 15px; 
            padding: 10px 15px; 
            color: #d84315; 
            font-weight: bold; 
            font-size: 18px; 
            pointer-events: none; /* ç‚¹å‡»ç©¿é€ */
            z-index: 100; 
            transform: translateX(-50%); 
            display: none; 
            text-align: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            min-width: 120px; 
            width: max-content;
            max-width: 90%;
            white-space: normal;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="nav-btn prevBtn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
        <div class="page-badge pageIndicator">1 / 6</div>
        <button class="nav-btn nextBtn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
        
        <div style="width: 1px; height: 30px; background: #eee; margin: 0 5px;"></div>
        
        <div class="config-item">
            <span style="font-size:20px;">è¯‘</span>
            <input type="checkbox" id="transToggle" checked style="width:22px;height:22px;accent-color:var(--green); cursor:pointer;">
        </div>
        <div class="config-item">
            <span class="icon-emoji">ğŸ¢</span>
            <input type="range" id="rate" min="0.5" max="1.5" step="0.1" value="0.9" style="width:80px;">
            <span class="icon-emoji">ğŸ°</span>
        </div>
        <div class="config-item">
            <select id="voiceSelect"></select>
        </div>
    </div>

    <div class="book-container" id="bookBox">
        <img id="bgImg" class="page-img" src="page1.png" alt="è¯¾æ–‡å›¾ç‰‡">
        <div id="transBubble" class="trans-popup"></div>
    </div>

    <div style="display:flex; align-items:center; gap:20px; margin-bottom: 30px;">
        <button class="nav-btn prevBtn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
        <div class="page-badge pageIndicator">1 / 6</div>
        <button class="nav-btn nextBtn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
    </div>

    <script>
        // --- Unit 3 æ•°æ® (å›¾ç‰‡å·²å…¨éƒ¨æ”¹ä¸º .png) ---
        const unitData = [
            { 
                img: "page1.png", 
                hotspots: [ 
                    { en: "Unit 3 Road safety", zh: "ç¬¬ä¸‰å•å…ƒ é“è·¯å®‰å…¨", t: 4, l: 20, w: 40, h: 8 }, 
                    { en: "car", zh: "æ±½è½¦", t: 56.5, l: 30, w: 10, h: 3 } 
                ] 
            },
            { 
                img: "page2.png", 
                hotspots: [ 
                    { en: "How do you keep safe on the road?", zh: "ä½ åœ¨è·¯ä¸Šå¦‚ä½•ä¿æŒå®‰å…¨ï¼Ÿ", t: 14, l: 62, w: 35, h: 6 }, 
                    { en: "bus", zh: "å…¬äº¤è½¦", t: 14, l: 20, w: 10, h: 3 }, 
                    { en: "traffic light", zh: "äº¤é€šä¿¡å·ç¯", t: 38, l: 30, w: 20, h: 3 }, 
                    { en: "road", zh: "é“è·¯", t: 44, l: 11, w: 10, h: 3 }, 
                    { en: "To talk about some traffic rules", zh: "è°ˆè®ºä¸€äº›äº¤é€šè§„åˆ™", t: 35, l: 65, w: 30, h: 5 }, 
                    { en: "To tell others how to cross the road", zh: "å‘Šè¯‰åˆ«äººå¦‚ä½•è¿‡é©¬è·¯", t: 41, l: 65, w: 30, h: 6 }, 
                    { en: "To discuss how to keep safe on the road", zh: "è®¨è®ºå¦‚ä½•åœ¨è·¯ä¸Šä¿æŒå®‰å…¨", t: 49, l: 65, w: 30, h: 6 }, 
                    { en: "1 Look at the picture. What can you see?", zh: "çœ‹å›¾ã€‚ä½ èƒ½çœ‹åˆ°ä»€ä¹ˆï¼Ÿ", t: 64, l: 64, w: 30, h: 6 }, 
                    { en: "2 Look at the traffic signs below. What do they mean?", zh: "çœ‹ä¸‹é¢çš„äº¤é€šæ ‡å¿—ã€‚å®ƒä»¬æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ", t: 71, l: 64, w: 30, h: 6 }, 
                    { en: "3 Think about answers to the big question.", zh: "æ€è€ƒæ ¸å¿ƒé—®é¢˜çš„ç­”æ¡ˆã€‚", t: 86, l: 64, w: 30, h: 6 } 
                ] 
            },
            { 
                img: "page3.png", 
                hotspots: [ 
                    { en: "Cartoon time. On the road", zh: "æ¼«ç”»æ—¶é—´ï¼šåœ¨è·¯ä¸Š", t: 7, l: 15, w: 50, h: 8 }, 
                    { en: "1 Let's go to Aunt Alice's home.", zh: "æˆ‘ä»¬å»çˆ±ä¸½ä¸é˜¿å§¨å®¶å§ã€‚", t: 18, l: 14, w: 35, h: 4 }, 
                    { en: "Great idea! We can take a bus.", zh: "å¥½ä¸»æ„ï¼æˆ‘ä»¬å¯ä»¥åå…¬äº¤è½¦ã€‚", t: 26, l: 55, w: 38, h: 5 }, 
                    { en: "2 There are many cars and buses on the road.", zh: "é©¬è·¯ä¸Šæœ‰å¾ˆå¤šå°æ±½è½¦å’Œå…¬äº¤è½¦ã€‚", t: 41, l: 15, w: 38, h: 5 }, 
                    { en: "Yes, it's busy.", zh: "æ˜¯çš„ï¼Œå¾ˆç¹å¿™ã€‚", t: 57, l: 25, w: 22, h: 3 }, 
                    { en: "3 The traffic lights are red now.", zh: "ç°åœ¨äº¤é€šç¯æ˜¯çº¢è‰²çš„ã€‚", t: 40, l: 58, w: 35, h: 5 }, 
                    { en: "We can't go.", zh: "æˆ‘ä»¬ä¸èƒ½èµ°ã€‚", t: 58.5, l: 73, w: 22, h: 5 }, 
                    { en: "4 Look! There are ducks on the road.", zh: "çœ‹ï¼é©¬è·¯ä¸Šæœ‰é¸­å­ã€‚", t: 65, l: 15, w: 38, h: 4 }, 
                    { en: "We can't go again!", zh: "æˆ‘ä»¬åˆä¸èƒ½èµ°äº†ï¼", t: 73, l: 40, w: 25, h: 3 }, 
                    { en: "Stay close!", zh: "è·Ÿç´§ç‚¹ï¼", t: 76, l: 75, w: 22, h: 3 }, 
                    { en: "Don't run!", zh: "åˆ«è·‘ï¼", t: 79, l: 75, w: 22, h: 3 }, 
                    { en: "Good little ducks.", zh: "å¥½å°é¸­å­ä»¬ã€‚", t: 82, l: 75, w: 22, h: 4 }, 
                    { en: "What traffic rules can you learn from the story?", zh: "æ€è€ƒï¼šä½ èƒ½ä»æ•…äº‹ä¸­å­¦åˆ°ä»€ä¹ˆäº¤é€šè§„åˆ™ï¼Ÿ", t: 92, l: 15, w: 65, h: 4 } 
                ] 
            },
            { 
                img: "page4.png", 
                hotspots: [ 
                    { en: "1 The traffic lights are red. The bus can't go.", zh: "äº¤é€šç¯æ˜¯çº¢è‰²çš„ã€‚å…¬äº¤è½¦ä¸èƒ½èµ°ã€‚", t: 14, l: 12, w: 55, h: 2.5 }, 
                    { en: "2 Bobby and Tina take a bus.", zh: "æ³¢æ¯”å’Œè’‚å¨œåå…¬äº¤è½¦ã€‚", t: 17, l: 12, w: 55, h: 2.5 }, 
                    { en: "3 There are ducks on the road. The bus can't go again.", zh: "é©¬è·¯ä¸Šæœ‰é¸­å­ã€‚å…¬äº¤è½¦åˆä¸èƒ½èµ°äº†ã€‚", t: 20, l: 12, w: 55, h: 2.5 }, 
                    { en: "4 Bobby and Tina want to see Aunt Alice.", zh: "æ³¢æ¯”å’Œè’‚å¨œæƒ³å»è§çˆ±ä¸½ä¸é˜¿å§¨ã€‚", t: 23, l: 12, w: 55, h: 2.5 }, 
                    { en: "Sounds in focus", zh: "è¯­éŸ³é‡ç‚¹", t: 56, l: 20, w: 30, h: 5 }, 
                    { en: "1 Listen to the sentences from the story and read.", zh: "å¬æ•…äº‹é‡Œçš„å¥å­å¹¶æœ—è¯»ã€‚", t: 62, l: 10, w: 60, h: 3 }, 
                    { en: "Let's go to Aunt Alice's home.", zh: "æˆ‘ä»¬å»çˆ±ä¸½ä¸é˜¿å§¨å®¶å§ã€‚", t: 64, l: 10, w: 45, h: 3 }, 
                    { en: "Stay close!", zh: "è·Ÿç´§ç‚¹ï¼", t: 64, l: 58, w: 20, h: 3 }, 
                    { en: "2 Listen to the rhyme and chant along. Then find more words.", zh: "å¬æ­Œè°£å¹¶è·Ÿç€å“¼å”±ã€‚ç„¶åæ‰¾å‡ºæ›´å¤šå•è¯ã€‚", t: 68, l: 10, w: 80, h: 3 }, 
                    { en: "Oh, it's a lovely day today.", zh: "å“¦ï¼Œä»Šå¤©æ˜¯ä¸ªå¯çˆ±çš„æ—¥å­ã€‚", t: 74, l: 10, w: 45, h: 3 }, 
                    { en: "Don't stay at home all day.", zh: "åˆ«æ•´å¤©å‘†åœ¨å®¶é‡Œã€‚", t: 77, l: 10, w: 45, h: 3 }, 
                    { en: "Take your bike and your helmet.", zh: "å¸¦ä¸Šä½ çš„è‡ªè¡Œè½¦å’Œå¤´ç›”ã€‚", t: 80, l: 10, w: 45, h: 3 }, 
                    { en: "Let's go and play!", zh: "æˆ‘ä»¬å»ç©å§ï¼", t: 83, l: 10, w: 45, h: 3 } 
                ] 
            },
            { 
                img: "page5.png", 
                hotspots: [ 
                    { en: "Story time", zh: "æ•…äº‹æ—¶é—´", t: 3, l: 15, w: 35, h: 6 }, 
                    { en: "Crossing the road", zh: "è¿‡é©¬è·¯", t: 10, l: 12, w: 45, h: 5 }, 
                    { en: "1 Mum, let's cross the road.", zh: "å¦ˆå¦ˆï¼Œæˆ‘ä»¬è¿‡é©¬è·¯å§ã€‚", t: 19, l: 14, w: 32, h: 6 }, 
                    { en: "Stop, Haohao!", zh: "åœä¸‹ï¼Œæµ©æµ©ï¼", t: 24, l: 51, w: 25, h: 4 }, 
                    { en: "The traffic lights are red.", zh: "äº¤é€šç¯æ˜¯çº¢è‰²çš„ã€‚", t: 34, l: 56, w: 38, h: 4 }, 
                    { en: "We can't cross the road now.", zh: "æˆ‘ä»¬ç°åœ¨ä¸èƒ½è¿‡é©¬è·¯ã€‚", t: 38, l: 56, w: 38, h: 3 }, 
                    { en: "Wait for the green traffic lights.", zh: "ç­‰ç»¿ç¯ã€‚", t: 41, l: 56, w: 38, h: 3 }, 
                    { en: "I'm sorry.", zh: "å¯¹ä¸èµ·ã€‚", t: 46, l: 15, w: 20, h: 3 }, 
                    { en: "2 Mum, the traffic lights are green. We can go now.", zh: "å¦ˆå¦ˆï¼Œäº¤é€šç¯å˜ç»¿äº†ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥èµ°äº†ã€‚", t: 80, l: 55, w: 38, h: 6 } 
                ] 
            },
            { 
                img: "page6.png", 
                hotspots: [ 
                    { en: "3 Wait. Look left and right first.", zh: "ç­‰ä¸€ä¸‹ã€‚å…ˆçœ‹å·¦å³ã€‚", t: 14, l: 8, w: 30, h: 6 }, 
                    { en: "4 That's right, Taotao.", zh: "æ²¡é”™ï¼Œæ¶›æ¶›ã€‚", t: 18, l: 48, w: 25, h: 5 }, 
                    { en: "It's safe now. We can cross the road.", zh: "ç°åœ¨å®‰å…¨äº†ã€‚æˆ‘ä»¬å¯ä»¥è¿‡é©¬è·¯äº†ã€‚", t: 8.5, l: 73, w: 22, h: 8 }, 
                    { en: "5 That's our bus.", zh: "é‚£æ˜¯æˆ‘ä»¬çš„å…¬äº¤è½¦ã€‚", t: 55, l: 36, w: 25, h: 3 }, 
                    { en: "Haohao, don't run on the road! It's not safe.", zh: "æµ©æµ©ï¼Œåˆ«åœ¨è·¯ä¸Šè·‘ï¼ä¸å®‰å…¨ã€‚", t: 71, l: 44, w: 35, h: 6 }, 
                    { en: "6 OK.", zh: "å¥½çš„ã€‚", t: 83, l: 30, w: 10, h: 3 }, 
                    { en: "How do the characters keep safe on the road?", zh: "æ€è€ƒï¼šè§’è‰²ä»¬åœ¨è·¯ä¸Šæ˜¯å¦‚ä½•ä¿æŒå®‰å…¨çš„ï¼Ÿ", t: 89, l: 51, w: 45, h: 5 } 
                ] 
            }
        ];

        let pIdx = 0;
        const synth = window.speechSynthesis;

        window.onload = () => { 
            loadVoices(); 
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            render(); 
        };

        function loadVoices() {
            // è·å–æ‰€æœ‰è‹±è¯­å£°éŸ³
            const voices = synth.getVoices().filter(v => v.lang.includes('en'));
            const select = document.getElementById('voiceSelect');
            if(voices.length > 0) {
                select.innerHTML = voices.map((v, i) => `<option value="${i}">${v.name.substring(0,15)}</option>`).join('');
            } else {
                select.innerHTML = '<option>é»˜è®¤å£°éŸ³</option>';
            }
        }

        function render() {
            const data = unitData[pIdx];
            document.getElementById('bgImg').src = data.img;
            document.querySelectorAll('.pageIndicator').forEach(el => el.innerText = (pIdx + 1) + " / " + unitData.length);
            document.querySelectorAll('.prevBtn').forEach(btn => btn.disabled = (pIdx === 0));
            document.querySelectorAll('.nextBtn').forEach(btn => btn.disabled = (pIdx === unitData.length - 1));
            
            document.getElementById('transBubble').style.display = "none";
            document.querySelectorAll('.hotspot').forEach(h => h.remove());

            data.hotspots.forEach(item => {
                const div = document.createElement('div');
                div.className = 'hotspot';
                div.style.top = item.t + "%"; 
                div.style.left = item.l + "%"; 
                div.style.width = item.w + "%"; 
                div.style.height = item.h + "%";
                
                div.onclick = function() {
                    // 1. åœæ­¢ä¹‹å‰çš„
                    synth.cancel();

                    // 2. å‡†å¤‡å‘éŸ³
                    const cleanText = item.en.replace(/^(\d+[\.\s]*)+/g, "").trim();
                    const utter = new SpeechSynthesisUtterance(cleanText);
                    utter.rate = document.getElementById('rate').value;
                    
                    // 3. é€‰å£°éŸ³
                    const voices = synth.getVoices().filter(v => v.lang.includes('en'));
                    const selIdx = document.getElementById('voiceSelect').value;
                    if(voices[selIdx]) utter.voice = voices[selIdx];

                    // 4. æ’­æ”¾
                    synth.speak(utter);

                    // 5. æ˜¾ç¤ºç¿»è¯‘ (ç½®é¡¶é€»è¾‘)
                    if(document.getElementById('transToggle').checked) {
                        const b = document.getElementById('transBubble');
                        b.innerText = item.zh;
                        b.style.display = "block";
                        
                        b.style.left = (item.l + item.w/2) + "%";
                        
                        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ™ºèƒ½åˆ¤æ–­
                        // 1. å¦‚æœå¥å­ä½ç½®åœ¨é¡µé¢é¡¶éƒ¨ (<20%)ï¼Œæ°”æ³¡å°±å¾€ä¸‹å¼¹ (æ”¾åœ¨å¥å­ä¸‹æ–¹)
                        if(item.t < 20) {
                            b.style.top = (item.t + item.h + 0.5) + "%";
                            b.style.bottom = "auto";
                        } 
                        // 2. å¦åˆ™ï¼Œé»˜è®¤å¾€ä¸Šå¼¹ (æ”¾åœ¨å¥å­ä¸Šæ–¹)
                        else {
                            b.style.top = "auto";
                            b.style.bottom = (100 - item.t + 2) + "%"; 
                        }
                    }
                };
                document.getElementById('bookBox').appendChild(div);
            });
        }

        function changePage(step) { 
            pIdx = Math.max(0, Math.min(unitData.length - 1, pIdx + step)); 
            window.scrollTo({top:0, behavior:'smooth'}); 
            render(); 
        }
    </script>
</body>
</html>